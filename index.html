<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Mi mascota dice NO</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      background: #fafafa;
      text-align: center;
      padding: 20px;
    }
    h1 {
      font-size: 1.8em;
      font-weight: 700;
    }
    #contenedorCanvas {
      display: flex;
      justify-content: center;
      margin-top: 20px;
    }
    canvas {
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      max-width: 100%;
      height: auto;
    }
    input, button {
      margin: 10px;
      padding: 8px 12px;
      font-size: 1em;
      border-radius: 6px;
      border: 1px solid #ccc;
    }
    button {
      cursor: pointer;
      background-color: #1976d2;
      color: white;
      border: none;
      transition: background 0.3s;
    }
    button:hover {
      background-color: #1258a0;
    }
    #logo {
      width: 120px;
      margin: 20px auto;
    }
    .botones {
      margin-top: 15px;
    }
    .botones a {
      margin: 0 5px;
      text-decoration: none;
    }
  </style>
</head>
<body>
  <h1>Genera tu afiche: <br>‚ÄúMi mascota dice NO a la Constituyente‚Äù</h1>

  <img id="logo" src="assets/logo.png" alt="Logo">

  <div>
    <input type="text" id="nombreMascota" placeholder="Nombre de tu mascota">
    <input type="file" id="fotoMascota" accept="image/*">
    <button id="cambiarPlantilla">Cambiar plantilla</button>
    <button id="generar">Generar afiche</button>
  </div>

  <div id="contenedorCanvas">
    <canvas id="canvas" width="800" height="1000"></canvas>
  </div>

  <div class="botones">
    <button id="descargar">‚¨áÔ∏è Descargar imagen</button>
    <a id="compartirFB" target="_blank">üìò Facebook</a>
    <a id="compartirIG" target="_blank">üì∏ Instagram</a>
    <a id="compartirWA" target="_blank">üí¨ WhatsApp</a>
  </div>

  <script>
    const canvas = document.getElementById("canvas");
    const ctx = canvas.getContext("2d");
    const nombreInput = document.getElementById("nombreMascota");
    const fotoInput = document.getElementById("fotoMascota");
    const descargarBtn = document.getElementById("descargar");
    const cambiarBtn = document.getElementById("cambiarPlantilla");
    const generarBtn = document.getElementById("generar");

    let indicePlantilla = 0;
    const plantillas = [
      {
        fondo: "assets/mi_mascota_dice_no.png",
        fraseInferior: "NO A LA CONSTITUYENTE. ¬°DEFENDAMOS NUESTROS DERECHOS!",
        colorTexto: "#ffffff"
      },
      {
        fondo: "assets/mi_mascota_dice_no_b.png",
        fraseInferior: "MI MASCOTA TAMBI√âN DICE NO. ¬°DEFENDAMOS EL FUTURO!",
        colorTexto: "#000000"
      }
    ];

    function ajustarTexto(ctx, texto, maxWidth, tama√±oInicial, fuenteBase) {
      let tama√±o = tama√±oInicial;
      do {
        ctx.font = `bold ${tama√±o}px ${fuenteBase}`;
        tama√±o -= 2;
      } while (ctx.measureText(texto).width > maxWidth && tama√±o > 20);
      return ctx.font;
    }

    function dibujarTextoMultilinea(ctx, texto, x, y, maxWidth, lineHeight) {
      const palabras = texto.split(" ");
      let l√≠nea = "";
      for (let i = 0; i < palabras.length; i++) {
        const prueba = l√≠nea + palabras[i] + " ";
        if (ctx.measureText(prueba).width > maxWidth && i > 0) {
          ctx.fillText(l√≠nea, x, y);
          l√≠nea = palabras[i] + " ";
          y += lineHeight;
        } else {
          l√≠nea = prueba;
        }
      }
      ctx.fillText(l√≠nea, x, y);
    }

    function generarAfiche() {
      const plantilla = plantillas[indicePlantilla];
      const fondo = new Image();
      fondo.src = plantilla.fondo;
      fondo.onload = () => {
        ctx.drawImage(fondo, 0, 0, canvas.width, canvas.height);

        const nombre = (nombreInput.value.toUpperCase() || "TU MASCOTA") + " DICE";
        ctx.fillStyle = plantilla.colorTexto;
        ctx.textAlign = "center";
        ctx.font = ajustarTexto(ctx, nombre, 550, 60, "Montserrat");
        ctx.fillText(nombre, canvas.width / 2, 250);

        const foto = new Image();
        const archivo = fotoInput.files[0];
        if (archivo) {
          const lector = new FileReader();
          lector.onload = () => {
            foto.src = lector.result;
            foto.onload = () => {
              const tama√±o = 500;
              const x = (canvas.width - tama√±o) / 2;
              ctx.drawImage(foto, x, 300, tama√±o, tama√±o);
              ctx.font = ajustarTexto(ctx, plantilla.fraseInferior, 700, 35, "Montserrat");
              dibujarTextoMultilinea(ctx, plantilla.fraseInferior, canvas.width / 2, 870, 700, 35);
            };
          };
          lector.readAsDataURL(archivo);
        } else {
          ctx.font = ajustarTexto(ctx, plantilla.fraseInferior, 700, 35, "Montserrat");
          dibujarTextoMultilinea(ctx, plantilla.fraseInferior, canvas.width / 2, 870, 700, 35);
        }
      };
    }

    generarBtn.addEventListener("click", generarAfiche);

    cambiarBtn.addEventListener("click", () => {
      indicePlantilla = (indicePlantilla + 1) % plantillas.length;
      generarAfiche();
    });

    descargarBtn.addEventListener("click", () => {
      const enlace = document.createElement("a");
      enlace.download = "mi_mascota_dice_no.png";
      enlace.href = canvas.toDataURL("image/png");
      enlace.click();
    });

    // Compartir
    function actualizarEnlaces() {
      const url = encodeURIComponent(window.location.href);
      const texto = encodeURIComponent("¬°Mi mascota dice NO a la Constituyente!");
      document.getElementById("compartirFB").href = `https://www.facebook.com/sharer/sharer.php?u=${url}`;
      document.getElementById("compartirIG").href = `https://www.instagram.com/`;
      document.getElementById("compartirWA").href = `https://api.whatsapp.com/send?text=${texto}%20${url}`;
    }

    actualizarEnlaces();
  </script>
</body>
</html>
